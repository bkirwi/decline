<!DOCTYPE html><html><head><title>decline: Structuring a complex CLI</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="com.monovore" /><meta name="description" content="Composable command-line parsing for Scala" /><meta name="og:image" content="/decline/img/poster.png" /><meta name="image" property="og:image" content="/decline/img/poster.png" /><meta name="og:title" content="decline: Structuring a complex CLI" /><meta name="title" property="og:title" content="decline: Structuring a complex CLI" /><meta name="og:site_name" content="decline" /><meta name="og:url" content="http://monovore.com/decline" /><meta name="og:type" content="website" /><meta name="og:description" content="Composable command-line parsing for Scala" /><link rel="icon" type="image/png" href="/decline/img/favicon.png" /><meta name="twitter:title" content="decline: Structuring a complex CLI" /><meta name="twitter:image" content="/decline/img/poster.png" /><meta name="twitter:description" content="Composable command-line parsing for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/decline/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/decline/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/decline/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/decline/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/decline/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/decline/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/decline/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/decline/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/decline/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/decline/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/decline/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/decline/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/decline/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/decline/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/decline/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/decline/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/decline/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/decline/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/decline/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/decline/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/decline/highlight/styles/solarized-light.css" /><link rel="stylesheet" href="/decline/css/pattern-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/decline/" class="brand"><div class="brand-wrapper"><span>decline</span></div></a></li> <li><a href="/decline/usage.html" class="">Using Decline</a></li> <li><a href="/decline/arguments.html" class="">Argument Types</a></li> <li><a href="/decline/structure.html" class=" active ">Structuring a complex CLI</a></li> <li><a href="/decline/effect.html" class="">Cats Effect</a></li> <li><a href="/decline/scalajs.html" class="">Scala.js and Scala Native</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav hidden-xs hidden-sm"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/bkirwi/decline" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/bkirwi/decline" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="bkirwi" data-github-repo="decline"><div class="content-wrapper"><section><p>If you’ve read the <a href="./usage.html">user’s guide</a>,
you’ve seen how to use <code class="language-plaintext highlighter-rouge">decline</code> to write a small command-line application.
Writing a large one is, broadly speaking, just more of the same…
but like any large codebase,
a big CLI can grow hard to deal with if it’s not structured well.</p>

<p><code class="language-plaintext highlighter-rouge">decline</code> is shaped a little differently than other command-line parsers,
so the options you have for structuring your code might not be obvious!
In this page,
we’ll walk through a few ideas that can help
and when they may be useful.</p>

<h2 id="a-running-example">A running example</h2>

<p>Let’s suppose we’re working on a simple command-line application.
It fetches its input from a remote endpoint or a local file,
processes it,
and writes out the result to another file.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.monovore.decline._</span>
<span class="k">import</span> <span class="nn">cats.syntax.all._</span>

<span class="k">import</span> <span class="nn">java.net.URI</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration.Duration</span>
<span class="k">import</span> <span class="nn">java.nio.file.Path</span>

<span class="c1">// We'll start by defining our individual options...</span>
<span class="k">val</span> <span class="nv">uriOpt</span> <span class="k">=</span> <span class="nv">Opts</span><span class="o">.</span><span class="py">option</span><span class="o">[</span><span class="kt">URI</span><span class="o">](</span><span class="s">"input-uri"</span><span class="o">,</span> <span class="s">"Location of the remote file."</span><span class="o">)</span>
<span class="c1">// uriOpt: Opts[URI] = Opts(--input-uri &lt;uri&gt;)</span>
<span class="k">val</span> <span class="nv">timeoutOpt</span> <span class="k">=</span> 
    <span class="nv">Opts</span><span class="o">.</span><span class="py">option</span><span class="o">[</span><span class="kt">Duration</span><span class="o">](</span><span class="s">"timeout"</span><span class="o">,</span> <span class="s">"Timeout for fetching the remote file."</span><span class="o">)</span>
      <span class="o">.</span><span class="py">withDefault</span><span class="o">(</span><span class="nv">Duration</span><span class="o">.</span><span class="py">Inf</span><span class="o">)</span>
<span class="c1">// timeoutOpt: Opts[Duration] = Opts([--timeout &lt;duration&gt;])</span>
<span class="k">val</span> <span class="nv">fileOpt</span> <span class="k">=</span> <span class="nv">Opts</span><span class="o">.</span><span class="py">option</span><span class="o">[</span><span class="kt">Path</span><span class="o">](</span><span class="s">"input-file"</span><span class="o">,</span> <span class="s">"Local path to input file."</span><span class="o">)</span>
<span class="c1">// fileOpt: Opts[Path] = Opts(--input-file &lt;path&gt;)</span>
<span class="k">val</span> <span class="nv">outputOpt</span> <span class="k">=</span> <span class="nv">Opts</span><span class="o">.</span><span class="py">argument</span><span class="o">[</span><span class="kt">Path</span><span class="o">](</span><span class="s">"output-file"</span><span class="o">)</span>
<span class="c1">// outputOpt: Opts[Path] = Opts(&lt;output-file&gt;)</span>

<span class="c1">// ...along with a case class that captures all our configuration data.</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Config</span><span class="o">(</span>
    <span class="n">uri</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">URI</span><span class="o">],</span>
    <span class="n">timeout</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">,</span>
    <span class="n">file</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Path</span><span class="o">],</span>
    <span class="n">output</span><span class="k">:</span> <span class="kt">Path</span><span class="o">,</span>
<span class="o">)</span>

<span class="c1">// Then, we combine our individual options into a `Opts[Config]` and validate the result.</span>
<span class="k">val</span> <span class="nv">configOpts</span><span class="k">:</span> <span class="kt">Opts</span><span class="o">[</span><span class="kt">Config</span><span class="o">]</span> <span class="k">=</span>
  <span class="o">(</span><span class="nv">uriOpt</span><span class="o">.</span><span class="py">orNone</span><span class="o">,</span> <span class="n">timeoutOpt</span><span class="o">,</span> <span class="nv">fileOpt</span><span class="o">.</span><span class="py">orNone</span><span class="o">,</span> <span class="n">outputOpt</span><span class="o">)</span>
    <span class="o">.</span><span class="py">mapN</span><span class="o">(</span><span class="nv">Config</span><span class="o">.</span><span class="py">apply</span><span class="o">)</span>
    <span class="o">.</span><span class="py">validate</span><span class="o">(</span><span class="s">"remote uri must be https"</span><span class="o">)(</span><span class="nv">_</span><span class="o">.</span><span class="py">uri</span><span class="o">.</span><span class="py">forall</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">getScheme</span> <span class="o">==</span> <span class="s">"https"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">validate</span><span class="o">(</span><span class="s">"timeout option is only valid for remote files"</span><span class="o">)(</span><span class="n">c</span> <span class="k">=&gt;</span> 
      <span class="c1">// if a non-default timeout is specified, uri must be present</span>
      <span class="nv">c</span><span class="o">.</span><span class="py">timeout</span> <span class="o">!=</span> <span class="nv">Duration</span><span class="o">.</span><span class="py">Inf</span> <span class="o">||</span> <span class="nv">c</span><span class="o">.</span><span class="py">uri</span><span class="o">.</span><span class="py">isDefined</span>
    <span class="o">)</span>
    <span class="o">.</span><span class="py">validate</span><span class="o">(</span><span class="s">"must provide either uri or file"</span><span class="o">)(</span><span class="n">c</span> <span class="k">=&gt;</span> <span class="nv">c</span><span class="o">.</span><span class="py">uri</span><span class="o">.</span><span class="py">isDefined</span> <span class="o">^</span> <span class="nv">c</span><span class="o">.</span><span class="py">file</span><span class="o">.</span><span class="py">isDefined</span><span class="o">)</span>
<span class="c1">// configOpts: Opts[Config] = Opts([--input-uri &lt;uri&gt;] [--timeout &lt;duration&gt;] [--input-file &lt;path&gt;] &lt;output-file&gt;)</span>

<span class="c1">// And finally, we pass the validated config to a `run` function that does the real work.</span>
<span class="k">def</span> <span class="nf">runApp</span><span class="o">(</span><span class="n">config</span><span class="k">:</span> <span class="kt">Config</span><span class="o">)</span> <span class="k">=</span> <span class="o">???</span>
<span class="nv">configOpts</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">runApp</span><span class="o">)</span>
<span class="c1">// res0: Opts[Nothing] = Opts([--input-uri &lt;uri&gt;] [--timeout &lt;duration&gt;] [--input-file &lt;path&gt;] &lt;output-file&gt;)</span>
</code></pre></div></div>

<p>To be clear: this code is basically fine!
It will run without errors,
and it’s fairly easy to understand what it does.
The suggestions below are most valuable
for complex interfaces with multiple options or subcommands…
but they’re easier to explain with a simple example.</p>

<h2 id="early-validation">Early validation</h2>

<p>Our example code first builds the full config,
then validates it,
and finally passes it to the rest of the program.
We don’t actually need the full config
to check that our input URI is valid, though;
let’s move that validation up to right where the option is defined.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">uriOpt</span> <span class="k">=</span>
  <span class="nv">Opts</span><span class="o">.</span><span class="py">option</span><span class="o">[</span><span class="kt">URI</span><span class="o">](</span><span class="s">"uri"</span><span class="o">,</span> <span class="s">"Location of the remote file."</span><span class="o">)</span>
    <span class="o">.</span><span class="py">validate</span><span class="o">(</span><span class="s">"remote uri must be https"</span><span class="o">)(</span><span class="nv">_</span><span class="o">.</span><span class="py">getScheme</span> <span class="o">==</span> <span class="s">"https"</span><span class="o">)</span>
<span class="c1">// uriOpt: Opts[URI] = Opts(--uri &lt;uri&gt;)</span>
</code></pre></div></div>

<p>You might prefer this because:</p>
<ul>
  <li>The validation itself is simpler;
it doesn’t need to extract the URI from the config object, 
or handle the case where it doesn’t exist.</li>
  <li>Since the option definition and the validation live together,
it’s a bit easier to see that the URI is validated correctly,
and harder to accidentally pass an unvalidated URI around by mistake.</li>
</ul>

<p>A fairly minor improvement in this case…
but the more complex your CLI, the more this sort of thing can help.</p>

<h2 id="grouping-related-options">Grouping related options</h2>

<p>The initial example listed out all the options in a single case class.
As your program grows,
it’s often helpful to break out smaller groups of options
that get passed around and validated together.
In our example,
the timeout only really makes sense if we’re fetching a remote resource,
so let’s group those two together in a new case class.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">RemoteConfig</span><span class="o">(</span><span class="n">uri</span><span class="k">:</span> <span class="kt">URI</span><span class="o">,</span> <span class="n">timeout</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">remoteOpts</span> <span class="k">=</span> <span class="o">(</span><span class="n">uriOpt</span><span class="o">,</span> <span class="n">timeoutOpt</span><span class="o">).</span><span class="py">mapN</span><span class="o">(</span><span class="nv">RemoteConfig</span><span class="o">.</span><span class="py">apply</span><span class="o">)</span>
<span class="c1">// remoteOpts: Opts[RemoteConfig] = Opts(--uri &lt;uri&gt; [--timeout &lt;duration&gt;])</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Config</span><span class="o">(</span>
    <span class="n">remote</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">RemoteConfig</span><span class="o">],</span>
    <span class="n">file</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Path</span><span class="o">],</span>
    <span class="n">output</span><span class="k">:</span> <span class="kt">Path</span><span class="o">,</span>
<span class="o">)</span>

<span class="k">val</span> <span class="nv">configOpts</span> <span class="k">=</span> 
  <span class="o">(</span><span class="nv">remoteOpts</span><span class="o">.</span><span class="py">orNone</span><span class="o">,</span> <span class="nv">fileOpt</span><span class="o">.</span><span class="py">orNone</span><span class="o">,</span> <span class="n">outputOpt</span><span class="o">)</span>
    <span class="o">.</span><span class="py">mapN</span><span class="o">(</span><span class="nv">Config</span><span class="o">.</span><span class="py">apply</span><span class="o">)</span>
    <span class="o">.</span><span class="py">validate</span><span class="o">(</span><span class="s">"must provide either uri or file"</span><span class="o">)(</span><span class="n">c</span> <span class="k">=&gt;</span> <span class="nv">c</span><span class="o">.</span><span class="py">remote</span><span class="o">.</span><span class="py">isDefined</span> <span class="o">^</span> <span class="nv">c</span><span class="o">.</span><span class="py">file</span><span class="o">.</span><span class="py">isDefined</span><span class="o">)</span>
<span class="c1">// configOpts: Opts[Config] = Opts([--uri &lt;uri&gt; [--timeout &lt;duration&gt;]] [--input-file &lt;path&gt;] &lt;output-file&gt;)</span>
</code></pre></div></div>

<p>With this change,
it’s no longer possible to define a <code class="language-plaintext highlighter-rouge">Config</code> that has a <code class="language-plaintext highlighter-rouge">timeout</code> but not a <code class="language-plaintext highlighter-rouge">uri</code>.
This means we can get rid of one of our explicit validations;
<code class="language-plaintext highlighter-rouge">decline</code> will do the equivalent input check automatically,
and its autogenerated <code class="language-plaintext highlighter-rouge">Usage: </code> info in the help output
will also reflect the new structure.</p>

<p>Other benefits include:</p>
<ul>
  <li>A single case class with twenty fields can get pretty unwieldy;
it becomes easy to accidentally pass arguments in the wrong order, for example.
Grouping arguments makes these errors less likely,
both because small groups are easier to see at a glance
and because the more explicit and specific your types are 
the more the compiler can help catch mistakes.</li>
  <li>It can make it easier to validate early –
if we decided we wanted to ban custom timeouts
when the URI was <code class="language-plaintext highlighter-rouge">localhost</code>, for example,
we could add that validation to <code class="language-plaintext highlighter-rouge">remoteOpts</code> instead of <code class="language-plaintext highlighter-rouge">configOpts</code>.</li>
</ul>

<h2 id="mutual-exclusion">Mutual exclusion</h2>

<p><code class="language-plaintext highlighter-rouge">orElse</code> is often used for subcommands,
but it works just as well for ordinary options.
Since our input file is always either local or remote,
using <code class="language-plaintext highlighter-rouge">orElse</code> can let us express that more directly.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Either would for two mutually-exclusive possibilities,</span>
<span class="c1">// but a sealed trait is a bit more general.</span>
<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">InputConfig</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">RemoteConfig</span><span class="o">(</span><span class="n">uri</span><span class="k">:</span> <span class="kt">URI</span><span class="o">,</span> <span class="n">timeout</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">InputConfig</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">LocalConfig</span><span class="o">(</span><span class="n">file</span><span class="k">:</span> <span class="kt">Path</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">InputConfig</span>

<span class="k">val</span> <span class="nv">remoteOpts</span> <span class="k">=</span> <span class="o">(</span><span class="n">uriOpt</span><span class="o">,</span> <span class="n">timeoutOpt</span><span class="o">).</span><span class="py">mapN</span><span class="o">(</span><span class="nv">RemoteConfig</span><span class="o">.</span><span class="py">apply</span><span class="o">)</span>
<span class="c1">// remoteOpts: Opts[RemoteConfig] = Opts(--uri &lt;uri&gt; [--timeout &lt;duration&gt;])</span>
<span class="k">val</span> <span class="nv">localOpts</span> <span class="k">=</span> <span class="nv">fileOpt</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="nv">LocalConfig</span><span class="o">.</span><span class="py">apply</span><span class="o">)</span>
<span class="c1">// localOpts: Opts[LocalConfig] = Opts(--input-file &lt;path&gt;)</span>
<span class="k">val</span> <span class="nv">inputOpts</span> <span class="k">=</span> <span class="n">remoteOpts</span> <span class="n">orElse</span> <span class="n">localOpts</span>
<span class="c1">// inputOpts: Opts[Product with Serializable with InputConfig] = Opts(--uri &lt;uri&gt; [--timeout &lt;duration&gt;] | --input-file &lt;path&gt;)</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Config</span><span class="o">(</span>
    <span class="n">input</span><span class="k">:</span> <span class="kt">InputConfig</span><span class="o">,</span>
    <span class="n">queries</span><span class="k">:</span> <span class="kt">Path</span><span class="o">,</span>
<span class="o">)</span>

<span class="k">val</span> <span class="nv">configOpts</span> <span class="k">=</span> <span class="o">(</span><span class="n">inputOpts</span><span class="o">,</span> <span class="n">outputOpt</span><span class="o">).</span><span class="py">mapN</span><span class="o">(</span><span class="nv">Config</span><span class="o">.</span><span class="py">apply</span><span class="o">)</span>
<span class="c1">// configOpts: Opts[Config] = Opts(--uri &lt;uri&gt; [--timeout &lt;duration&gt;] &lt;output-file&gt; | --input-file &lt;path&gt; &lt;output-file&gt;)</span>
</code></pre></div></div>

<p>That gets rid of our final config validation;
<code class="language-plaintext highlighter-rouge">decline</code> ensures that the user passes either <code class="language-plaintext highlighter-rouge">--uri</code> or <code class="language-plaintext highlighter-rouge">--input-file</code>,
but never both.</p>

<p>It’s often possible to replace ad-hoc validation
with more precise data modelling like this,
and it’s almost always a good idea when you can:
it simplifies the code,
improves the error messages and usage texts that <code class="language-plaintext highlighter-rouge">decline</code> generates,
and helps “make illegal states unrepresentable” in your program.</p>

<h2 id="config-and-effect-style">Config and effect style</h2>

<p>Through every step of the refactoring above,
the shape of our command-line parser closely matches the <code class="language-plaintext highlighter-rouge">Config</code> datastructure;
we build parsers for case classes using <code class="language-plaintext highlighter-rouge">mapN</code> and sealed traits using <code class="language-plaintext highlighter-rouge">orElse</code>,
working our way up from simpler types to the full <code class="language-plaintext highlighter-rouge">Config</code>.
(And once that’s done,
we hand the whole thing off to some <code class="language-plaintext highlighter-rouge">run</code> function
that does the actual work.)
This “config” pattern is a very common way to structure an application using <code class="language-plaintext highlighter-rouge">decline</code>,
and it’s easy to test:
users often write unit tests that pass different arguments to the parser
and assert that they parse successfully,
or have the contents you’d expect.</p>

<p>It’s also possible to avoid building up intermediate configs,
instead just calling functions that take the appropriate action directly.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// This example code uses cats-effect's IO, but the pattern works just as well for</span>
<span class="c1">// imperative programs... just change the return type of the fetch functions</span>
<span class="c1">// to `Future[String]`, `String`, or whatever else makes sense in your context.</span>
<span class="k">import</span> <span class="nn">cats.effect.IO</span>

<span class="k">def</span> <span class="nf">fetchRemote</span><span class="o">(</span><span class="n">uri</span><span class="k">:</span> <span class="kt">URI</span><span class="o">,</span> <span class="n">timeout</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
<span class="k">def</span> <span class="nf">fetchLocal</span><span class="o">(</span><span class="n">file</span><span class="k">:</span> <span class="kt">Path</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>

<span class="k">val</span> <span class="nv">remoteOpts</span> <span class="k">=</span> <span class="o">(</span><span class="n">uriOpt</span><span class="o">,</span> <span class="n">timeoutOpt</span><span class="o">).</span><span class="py">mapN</span><span class="o">(</span><span class="n">fetchRemote</span><span class="o">)</span>
<span class="c1">// remoteOpts: Opts[IO[String]] = Opts(--uri &lt;uri&gt; [--timeout &lt;duration&gt;])</span>
<span class="k">val</span> <span class="nv">localOpts</span> <span class="k">=</span> <span class="nv">fileOpt</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">fetchLocal</span><span class="o">)</span>
<span class="c1">// localOpts: Opts[IO[String]] = Opts(--input-file &lt;path&gt;)</span>
<span class="k">val</span> <span class="nv">inputOpts</span> <span class="k">=</span> <span class="n">remoteOpts</span> <span class="n">orElse</span> <span class="n">localOpts</span>
<span class="c1">// inputOpts: Opts[IO[String]] = Opts(--uri &lt;uri&gt; [--timeout &lt;duration&gt;] | --input-file &lt;path&gt;)</span>

<span class="k">def</span> <span class="nf">run</span><span class="o">(</span><span class="n">input</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span> <span class="n">output</span><span class="k">:</span> <span class="kt">Path</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>

<span class="k">val</span> <span class="nv">configOpts</span> <span class="k">=</span> <span class="o">(</span><span class="n">inputOpts</span><span class="o">,</span> <span class="n">outputOpt</span><span class="o">).</span><span class="py">mapN</span><span class="o">(</span><span class="n">run</span><span class="o">)</span>
<span class="c1">// configOpts: Opts[IO[Unit]] = Opts(--uri &lt;uri&gt; [--timeout &lt;duration&gt;] &lt;output-file&gt; | --input-file &lt;path&gt; &lt;output-file&gt;)</span>
</code></pre></div></div>

<p>This code is shorter and more direct than the config-based example,
and avoids needing any intermediate data structures to represent the input.
On the other hand,
it’s somewhat more opaque and harder to test or validate.
Either approach can work well,
and some apps use both styles in different places.
Follow your heart!</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/decline/highlight/highlight.pack.js"></script><script src="/decline/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/decline/js/search.js"></script><script src="/decline/js/main.js"></script></body></html>